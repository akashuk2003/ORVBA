{% extends 'base.html' %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-12">
        <div class="alert alert-success d-flex justify-content-between align-items-center">
            <div>
                <h2 class="alert-heading h4">Mechanic Dashboard</h2>
                <p class="mb-0">You are <strong>Online</strong> and ready to accept requests.</p>
            </div>
            <div>
                <span class="badge bg-light text-dark fs-6">Approved Partner</span>
            </div>
        </div>
    </div>
</div>
<h4 class="mb-3 text-success">üìç New Available Requests</h4>
<div class="row mb-5">
    {% for job in available_jobs %}
    <div class="col-md-4 mb-4">
        <div class="card shadow border-success h-100">
            <div class="card-header bg-success text-white d-flex justify-content-between">
                <span>NEW REQUEST</span>
                <small>{{ job.created_at|timesince }} ago</small>
            </div>
            <div class="card-body">
                <h5 class="card-title">{{ job.service_type }}</h5>
                <p class="card-text">
                    <strong>User:</strong> {{ job.customer.username }}<br>
                    <small class="text-muted">Location coordinates provided.</small>
                </p>
                <div class="d-grid">
                    <a href="{% url 'request_details' job.id %}" class="btn btn-outline-success">
                        View & Accept
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="col-12">
        <div class="alert alert-light border text-center text-muted">
            No new requests nearby at the moment.
        </div>
    </div>
    {% endfor %}
</div>
<hr>
<h4 class="mb-3">Assigned Jobs</h4>

<div class="row">
    {% for task in tasks %}
    <div class="col-md-4 mb-4">
        <div class="card shadow-sm border-{% if task.status == 'Pending' %}warning{% elif task.status == 'Accepted' %}info{% else %}success{% endif %}">
            <div class="card-header d-flex justify-content-between align-items-center">
                <strong>Request #{{ task.id }}</strong>
                <span class="badge bg-secondary">{{ task.created_at|date:"H:i" }}</span>
            </div>
            <div class="card-body">
                <h5 class="card-title">{{ task.service_type }}</h5>
                <p class="card-text">
                    <strong>Customer:</strong> {{ task.customer.username }}<br>
                    <strong>Phone:</strong> {{ task.customer.phone_number }}
                </p>
                
                <div class="d-grid gap-2">
                    <a href="{% url 'request_details' task.id %}" class="btn btn-primary">
                        View Map & Action
                    </a>
                </div>
            </div>
            <div class="card-footer text-center">
                Status: <strong>{{ task.status }}</strong>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="col-12 text-center py-5">
        <h4 class="text-muted">No active jobs assigned.</h4>
        <p>Wait for new requests or contact Admin.</p>
    </div>
    {% endfor %}
</div>
{% endblock %}